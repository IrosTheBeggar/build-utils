# @vamship/grunt-utils

_Library of modules that are designed to construct an opinionated dev/build
toolchain for Javascript and Typescript projects._

> This library was originally intended for internal consumption, though the
> functionality provided by this library is fairly generic.

## API Documentation

API documentation can be found [here](https://vamship.github.io/build-utils).

## Motivation

In addition to writing code (and tests!), every project brings with it a common
set of tasks that comprise a _development workflow_ for the project. This
workflow includes common activities such as linting, formatting files, testing,
building, packaging, etc.

Having consistent way of performing these tasks makes it easier to switch from
one project to another, because all common tasks will be identical for a given
class of project (nodejs library, API server, etc.).

In order to ensure this consistency, a common task automation framework (Gulp)
is used, combined with a consistent configuration and development tool set for
that framework.

This library exports modules and classes that enable the creation of Gulpfiles,
ensuring that they can be ported from project to project with no changes.

All project specific parameters can be declared within a `buildMetdata` property
in package.json.

## Installation

This library can be installed using npm:

```
npm install @vamship/build-utils
```

## Usage

This library is intended to be used with a Gulpfile that imports the necessary
tasks for the build system. The `examples` directory has a sample Gulpfile that
can be used for any project.

### Configuring package.json

The build system derives its configuration from buildMetadata that is explicitly
passed to the the project object via the Gulpfile, or by configuring settings
in the package.json file. We **strongly recommend** the use of package.json to
configure the build system.

Build metadata is identified in `package.json` via a property named
`buildMetadata`, which is an object that supports the following fields:

``` json
{
  "projectType": "lib|cli|api|aws-microservice|container",
  "language": "ts|js",
  "requiredEnv": [ "...", "..." ],
  "aws": {
    "stacks" {
      "stack-key": "stack-name",
      ...
    }
  },
  "docker": {
      "repo": "...",
      "registry": "..."
      "buildArgs": {
        "arg-name": "__ENV__|<value>"
      }
  }
}
```
Note that all properties are not required for all types of projects. Refer to
the package.json files in the `examples` directory to get an idea of typical
configuration for different project types.

#### Properties:
`projectType`: Identifies the project type, which in turn determines the build
tasks generated by the system.

`language`: The project language - javascript or typescript.

`requiredEnv`: A list of environment variables that must be defined prior to some
tasks, such as publishing AWS projects, packaging docker images, publishing
private npm repositories, etc. The build system only checks for the existinence
of these variables, but does not care about their values.

`aws`: This object must be specified for aws microservice projects.
`aws.stacks`: This sub object defines a list of cloud formation stacks published
by the project. The keys represent the names that will be used for the gulp
tasks, and the values are the names of the cloud formation stacks.

`docker`: This object must be sepcified for projects that result in docker
images.  This could apply to multiple project types including `cli`, `api` and
`container`.

`docker.repo`: A fully qualified repo name to be used to publish docker images.
`docker.registry`: If the repo name is to be derived from the project name, this
property can be used to identify a custom registry. The final repo will be
generated by concatenating the project name to the registry name.
`docker.buildArgs`: This is a map of build arguments that will be passed to
docker at build time. The keys are the build argument names, and the values are
the argument values. A special value `__ENV__` indicates that the actual value
of the build argument must be extracted from the environment.
